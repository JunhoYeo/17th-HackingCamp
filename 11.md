# Network Protocol Fuzzing
이영주 발표자님

## 시작하기 전에
Linux Binary Exploit -> Windows ?

## 퍼징
예상되지 않은 input을 넣고 터지나 안터 지나

## 파일 퍼징
input을 파일로 넣고 터지나 안터지나

## 파일 퍼징 - 대상
파일을 이용하는 어떤 리얼월드 프로그램이든

## 파일 퍼징 - 원리
jpeg generator -> input으로 계속 주고 -> error detection<br>
BFF, FOE...

## 파일 퍼저
- 장점 : 퍼징에 대한 기본적인 개념을 이해할 수 있음, 만들기 쉬움
- 단점 : 만들기에는 이미 너무 좋은 퍼져들이 많음, 취약점 찾기 어려움

## 저는..
> 네트워크 퍼저를 만들자

파일 퍼저 : 저절로 돌면서 crash를 찾아줌, crash가 나와도 찾기 힘드니까...

## 파일퍼저 vs 네트워크퍼저
- 입력이 파일에서 패킷으로 변함
- 범용적인 퍼저를 짜기 힘듬(패킷 내용은 매우 다양하고 많으니)
- 프로그램의 특정 상태를 구분짓는 것이 매우 힘듬
- 익스플로잇을 하게 되면 remote인 경우가 많기 때문에 파급력이 큼

## 대상은?
원격제어 프로그램<br>
클라이언트 -> 서버

## 방법은?
랜덤 패킷 -> 서버

끝?

## 문제점 1
크래시를 어떻게 탐지하고 저장하지? -> windbg!!

## 문제점 2
무작위 패킷은 어떻게 보내지? -> python socket

## 지금까지 형태
randompacket.py -> 서버 -> windbg

## 이대로면 10년

## 개선할점
어떤 패킷을 보내야 크래시가 잘 터질까?? -> 프로토콜 분석

## 프로토콜
클라이언트 -> 서버 간 네트워크에서 서로 통신할 때 사용하는 규칙<br>
양쪽 프로그램 버전, 전송할 데이터 크기, 수락, 데이터 전송, 수락...

## 이걸 무시하고 보낸다면? (때려넣기)
> 서버: 무시(평온)

## 프로토콜
프로토콜을 알아내는 방법 : 유명 프로토콜일 경우 문서 확인, 독자적인 프로토콜의 경우 리버싱-

## 프로토콜에 맞게 퍼징할 데이터를 설계
프로그램 버전 -> 고정값<br>
전송할 데이터 크기 -> 숫자(랜덤)<br>
데이터 전송 -> 랜덤 데이터

## 최종 형태
randompacket.py (크래시 있으면 보낸 패킷 저장) -> 프로토콜에 따른 랜덤 패킷 전송 -> windbg로 크래시 확인

## 그래도 아쉽다면
랜덤 데이터를 보낼 때는

1. 원래 클라이언트가 보내려던 데이터 캡쳐
2. 데이터 뮤테이션(일부만 변조하여 전송)

## 지속적인 개선 필요
> 정말 많은 개선이 필요합니다

## 퍼저를 완성했다면?

## 결과

## 버그바운티

## 네트워크 퍼징 어려운점

- 보통 패킷을 주고받을때는 암호화를 사용 -> AES, SSL, RSA, 자체암호화(제일 힘듬)
- 퍼징을 하다보면 크래시를 재현해야 하는데, 언제/어떻게/왜 크래시가 발생했는지 알아내기 어려움(시간으로 패킷 저장 -> 시간으로 크래시 기록)
- 프로토콜이 너무 많고 자체적으로 쓰는 프로토콜도 너무 많아서 분석하기 매우 힘듬 -> RDP, VNC, RFB, 자체프로토콜(이것도 가장 힘듬)
- 통신 전에 사용자인증을 하거나 중간에 서버를 거치면 퍼징하기 매우 어려워진다(함부로 퍼징하면 불법!!)
